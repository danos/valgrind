Description: Fix FTBFS with glibc-2.17
Origin: upstream, svn://svn.valgrind.org/valgrind/trunk@13228
Debian-Bug: http://bugs.debian.org/707438
Author: tom
Reviewed-by: Alessandro Ghedini <ghedo@debian.org>
Last-Update: 2013-05-09

--- a/configure.in
+++ b/configure.in
@@ -906,6 +906,13 @@
 	DEFAULT_SUPP="glibc-2.34567-NPTL-helgrind.supp ${DEFAULT_SUPP}"
 	DEFAULT_SUPP="glibc-2.X-drd.supp ${DEFAULT_SUPP}"
 	;;
+     2.17)
+	AC_MSG_RESULT(2.17 family)
+	AC_DEFINE([GLIBC_2_17], 1, [Define to 1 if you're using glibc 2.17.x])
+	DEFAULT_SUPP="glibc-2.X.supp ${DEFAULT_SUPP}"
+	DEFAULT_SUPP="glibc-2.34567-NPTL-helgrind.supp ${DEFAULT_SUPP}"
+	DEFAULT_SUPP="glibc-2.X-drd.supp ${DEFAULT_SUPP}"
+	;;
      darwin)
 	AC_MSG_RESULT(Darwin)
 	AC_DEFINE([DARWIN_LIBC], 1, [Define to 1 if you're using Darwin])
@@ -919,7 +926,7 @@
 
      *)
 	AC_MSG_RESULT([unsupported version ${GLIBC_VERSION}])
-	AC_MSG_ERROR([Valgrind requires glibc version 2.2 - 2.16])
+	AC_MSG_ERROR([Valgrind requires glibc version 2.2 - 2.17])
 	AC_MSG_ERROR([or Darwin libc])
 	;;
 esac
--- a/config.h.in
+++ b/config.h.in
@@ -48,6 +48,9 @@
 /* Define to 1 if you're using glibc 2.16.x */
 #undef GLIBC_2_16
 
+/* Define to 1 if you're using glibc 2.17.x */
+#undef GLIBC_2_17
+
 /* Define to 1 if you're using glibc 2.2.x */
 #undef GLIBC_2_2
 
--- a/configure
+++ b/configure
@@ -6604,6 +6604,16 @@
 	DEFAULT_SUPP="glibc-2.34567-NPTL-helgrind.supp ${DEFAULT_SUPP}"
 	DEFAULT_SUPP="glibc-2.X-drd.supp ${DEFAULT_SUPP}"
 	;;
+     2.17)
+	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: 2.17 family" >&5
+$as_echo "2.17 family" >&6; }
+
+$as_echo "#define GLIBC_2_17 1" >>confdefs.h
+
+	DEFAULT_SUPP="glibc-2.X.supp ${DEFAULT_SUPP}"
+	DEFAULT_SUPP="glibc-2.34567-NPTL-helgrind.supp ${DEFAULT_SUPP}"
+	DEFAULT_SUPP="glibc-2.X-drd.supp ${DEFAULT_SUPP}"
+	;;
      darwin)
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Darwin" >&5
 $as_echo "Darwin" >&6; }
@@ -6624,7 +6634,7 @@
      *)
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: unsupported version ${GLIBC_VERSION}" >&5
 $as_echo "unsupported version ${GLIBC_VERSION}" >&6; }
-	as_fn_error "Valgrind requires glibc version 2.2 - 2.16" "$LINENO" 5
+	as_fn_error "Valgrind requires glibc version 2.2 - 2.17" "$LINENO" 5
 	as_fn_error "or Darwin libc" "$LINENO" 5
 	;;
 esac
